<ng-container *ngFor="let message of messages;
                      let isLast = last;
                      let isFirst = first;
                      let index = index;
                      trackBy: trackByMessageId">

    <div class="msg-date" *ngIf="message.created_at as date">{{date}}</div>

    <div [ngClass]="message.value | messengerClass:messages[index-1]?.value:messages[index+1]?.value:isFirst:isLast:message.created_at:messages[index-1]?.created_at">

        <div class="msg-avatar" *ngIf="(avatarMe && message.direction === 'me') || (avatarOthers && message.direction === 'others')">
            <!--
            <mark6-image
                [preview]="message.value.avatar?.preview | base64"
                [default]="message.value.userGender | gender"
                [srcSet]="message.value.avatar | srcSet:[36,72,108]:['1x','2x','3x']"
                [src]="message.value.avatar | size:36"
                [alt]="message.value.user">
            </mark6-image>
            -->
        </div>

        <div class="msg-content" (click)="showTime(message)">
            <div class="msg-message" [ngClass]="{temp:message.tmp}">
                <div class="header" *ngIf="type === 'group' && message.direction === 'others'">{{message.user}}</div>
                <span>{{message.message}}</span>
                <div class="footer" *ngIf="message.showTime" @fade>
                    <span>{{message.created_at }}</span>
                </div>
            </div>
        </div>

    </div>
</ng-container>
