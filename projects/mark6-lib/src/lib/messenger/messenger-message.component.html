<ng-container *ngFor="let message of messages; let isLast = last; let isFirst = first; let i = index; trackBy: trackByMessageId">

    <div class="msg-date" *ngIf="message.value.postedAt as d">{{d}}</div>

    <div
        [ngClass]="message.value | messengerClass:messages[i-1]?.value:messages[i+1]?.value:isFirst:isLast:message.value.postedAt:messages[i-1]?.value.postedAt">

        <div class="msg-avatar"
            *ngIf="(avatarMe && message.value.direction === 'me') || (avatarOthers && message.value.direction === 'others')">

        </div>

        <div class="msg-content" (click)="showTime(message)">
            <div class="msg-message" [ngClass]="{temp:message.value.tmp}">
                <div class="header" *ngIf="type === 'group' && message.value.direction === 'others'">
                    {{message.value.user}}</div>
                <span>{{message.value.message}}</span>
                <div class="footer" *ngIf="message.showTime" @fade>
                    <span>{{message.value.postedAt }}</span>
                </div>
            </div>
        </div>

    </div>
</ng-container>